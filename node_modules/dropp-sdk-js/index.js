(()=>{"use strict";var t={39:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PromiseToPay=void 0,e.PromiseToPay=class{constructor(t){this.payer=t.payer,this.invoiceBytes=t.invoiceBytes,this.timeStamp=t.timeStamp,this.signatures=t.signatures,this.distributionBytes=t.distributionBytes,this.encodedHHTransfer=t.encodedHHTransfer,this.purchaseURL=t.purchaseURL,this.shareURL=t.shareURL,this.walletCurrency=t.walletCurrency,this.exchangeRate=t.exchangeRate,this.droppCredits=t.droppCredits,this.droppCreditsInInvoiceCurrency=t.droppCreditsInInvoiceCurrency,this.droppCreditsInWalletCurrency=t.droppCreditsInWalletCurrency}decodeDistributionBytes(){if(this.distributionBytes){const t=Buffer.from(this.distributionBytes,"base64").toString("utf-8");return JSON.parse(t)}}decodeInvoiceBytes(){const t=Buffer.from(this.invoiceBytes,"base64").toString("utf-8");return JSON.parse(t)}}},63:(t,e)=>{var r;Object.defineProperty(e,"__esModule",{value:!0}),e.DroppEnvironment=void 0;class n{constructor(t,e){this._name=t,this._url=e}static get(t){const e=this.envBaseUrls.get(t);if(e)return new r(t,e);throw"Unknown Environment"}get name(){return this._name}get url(){return this._url}}e.DroppEnvironment=n,r=n,n.envBaseUrls=new Map([["SANDBOX","https://sandbox.api.dropp.cc"],["PROD","https://api.dropp.cc"]])},82:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e._DroppHttpClient=void 0;const o=r(63),i=r(938),s=r(555),a=r(531),p=r(724),u=r(857);class c{constructor(t){this.environment=o.DroppEnvironment.get(t),this.axiosInstance=i.default.create({baseURL:this.environment.url,timeout:3e4}),this.axiosInstance.defaults.headers.common["User-Agent"]=this.generateUserAgentString(),this.axiosInstance.interceptors.request.use(function(t){return t.headers&&("function"==typeof t.headers.set?t.headers.set("Content-Type","application/json"):t.headers["Content-Type"]="application/json"),t},function(t){return Promise.reject(t)}),this.axiosInstance.interceptors.response.use(function(t){return c.isRpsP2pApi(t)?t=c.transformRpsP2pResponse(t):c.isRpsAuthApi(t)&&(t=c.transformRpsAuthResponse(t)),t},function(t){return Promise.reject(t)})}static isRpsAuthApi(t){return"/api/rps/v1/payments"===t.config.url}static transformRpsAuthResponse(t){if(c.isRpsAuthApi(t)){const e=t.data;t.data={responseCode:0,errors:[],data:{recurringToken:e.value}}}return t}static isRpsP2pApi(t){return"/api/rps/v1/payments/p2p"===t.config.url}static transformRpsP2pResponse(t){if(c.isRpsP2pApi(t)){const e=t.data;t.data={responseCode:0,errors:[],data:e.paymentData}}return t}generateUserAgentString(){return"DroppSdkJs/"+s.DROPP_SDK_VERSION+" ("+u.type()+")"}postToDroppService(t,e){return n(this,void 0,void 0,function*(){let r;if(yield this.axiosInstance.post(t,e).then(function(t){(0,p.droppLog)("Response received"),r=t}).catch(function(t){if((0,p.droppLog)("Error"),t.response.data)throw new Error(JSON.stringify(t.response.data));{const e=JSON.parse(JSON.stringify(t));throw e.status?new Error(JSON.stringify({code:e.code,status:e.status,message:e.message})):new Error("Unknown error response")}}),r.data){const t=r.data;return new a.DroppResponse(t.responseCode,t.errors,t.data)}throw new Error("Unknown response")})}getStatusForUUID(t){return n(this,void 0,void 0,function*(){let e;try{e=yield this.axiosInstance.get(t)}catch(t){(0,p.droppLog)("Error"),console.error(t)}if(e.data){const t=e.data;return new a.DroppResponse(t.responseCode,t.errors,t.data)}throw new Error("Unknown response")})}}e._DroppHttpClient=c},131:t=>{t.exports=require("tweetnacl")},181:t=>{t.exports=require("buffer")},218:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppTransactionRequest=void 0;const o=r(328);e.DroppTransactionRequest=class{constructor(t){this.droppClient=t}getTransactions(t,e,r){return n(this,void 0,void 0,function*(){const n=o.DroppSignatureGenerator.generateSignatureForData(Object.assign({},t),r);return this.fetchTransactions(t,e,n)})}fetchTransactions(t,e,r){return n(this,void 0,void 0,function*(){const n=`/api/v1/merchants/${e}/getTransactions`,o={methodName:"getTxHistoryLinkedMerchants",base64JsonContent:Buffer.from(JSON.stringify(t)).toString("base64"),signature:r};return console.log("Fetch Transactions with params : ",o),yield this.droppClient.postToDroppService(n,o)})}}},328:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DroppSignatureGenerator=void 0;const n=r(181),o=r(131);e.DroppSignatureGenerator=class{static generateMerchantSignature(t,e){if(null!=t){const r=[n.Buffer.from(t,"hex")],i=this.removeKeyPrefix(e),s=o.sign.keyPair.fromSeed(new Uint8Array(n.Buffer.from(i,"hex"))),a=o.sign.detached(new Uint8Array(n.Buffer.concat(r)),s.secretKey);return n.Buffer.from(a.buffer).toString("hex")}throw new Error("Missing data to sign")}static generateSignatureForData(t,e){if(0===Object.keys(t).length)throw new Error("Cannot generate signature: dataToSignInJSON is empty.");const r=n.Buffer.from(JSON.stringify(t)).toString("hex");return this.generateMerchantSignature(r,e)}static removeKeyPrefix(t){return t.startsWith("302e020100300506032b657004220420")?t.slice(32):t}}},430:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppCreditPaymentRequest=void 0;const o=r(328);e.DroppCreditPaymentRequest=class{constructor(t){this.droppClient=t}submit(t,e){return n(this,void 0,void 0,function*(){const r=Buffer.from(JSON.stringify(t)).toString("base64"),n={methodName:"creditToUser",base64JsonContent:r,signature:o.DroppSignatureGenerator.generateMerchantSignature(Buffer.from(r).toString("hex"),e)};return yield this.droppClient.postToDroppService("/merchant/processRequest",n)})}}},440:function(t,e,r){var n=this&&this.__createBinding||(Object.create?function(t,e,r,n){void 0===n&&(n=r);var o=Object.getOwnPropertyDescriptor(e,r);o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[r]}}),Object.defineProperty(t,n,o)}:function(t,e,r,n){void 0===n&&(n=r),t[n]=e[r]}),o=this&&this.__exportStar||function(t,e){for(var r in t)"default"===r||Object.prototype.hasOwnProperty.call(e,r)||n(e,t,r)};Object.defineProperty(e,"__esModule",{value:!0}),o(r(472),e),o(r(430),e),o(r(866),e),o(r(702),e),o(r(531),e),o(r(619),e),o(r(39),e),o(r(218),e)},472:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppPaymentRequest=void 0;const o=r(328);e.DroppPaymentRequest=class{constructor(t){this.droppClient=t}submit(t,e){return n(this,void 0,void 0,function*(){return t.signatures.merchant=o.DroppSignatureGenerator.generateMerchantSignature(t.signatures.payer,e),this.submitForPayment(t)})}submitForSubMerchant(t,e,r){return n(this,void 0,void 0,function*(){return t.signatures.merchant=o.DroppSignatureGenerator.generateMerchantSignature(t.signatures.payer,e),this.submitForSubMerchantPayment(t,r)})}submitForPayment(t){return n(this,void 0,void 0,function*(){const e={methodName:"payMerchantV2",paymentData:t};return yield this.droppClient.postToDroppService("/payment/processRequest",e)})}submitForSubMerchantPayment(t,e){return n(this,void 0,void 0,function*(){const r=`/api/v1/merchants/${e}/processRequest`;return console.log("Post data for sub-merchant payment:",t),yield this.droppClient.postToDroppService(r,t)})}}},531:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DroppResponse=void 0,e.DroppResponse=class{constructor(t,e,r){this.responseCode=t,this.errors=e,this.data=r}}},555:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.DROPP_SDK_NAME=e.DROPP_SDK_VERSION=void 0,e.DROPP_SDK_VERSION="0.1.1",e.DROPP_SDK_NAME="dropp-sdk-js"},619:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppClient=void 0;const o=r(82),i=r(724),s=r(555),a=r(531);e.DroppClient=class{constructor(t){this.env=t,this.droppHttpClient=new o._DroppHttpClient(t),(0,i.droppLog)(`Version: ${s.DROPP_SDK_VERSION}`),(0,i.droppLog)(`Environment: ${this.env}`)}postToDroppService(t,e){return n(this,void 0,void 0,function*(){return this.droppHttpClient.postToDroppService(t,e)})}generateUUID(t){return n(this,void 0,void 0,function*(){const e={qr_type:"PAY_REQUEST",data:t},r=yield this.droppHttpClient.postToDroppService("/api/walletext/v1/qrcode/generateUUID",JSON.stringify({data:JSON.stringify(e)})),n=r.data;return new a.DroppResponse(r.responseCode,r.errors,{link:`${"PROD"===this.env?"https://paymentslink.dropp.cc":"https://paymentslink.dropp.cc/sandbox"}/checkDroppApp?uuid=${n}`,uuid:n})})}waitForCompletion(t){return n(this,arguments,void 0,function*(t,e=10,r=3e3){const n=`/api/walletext/v1/qrcode/getStatusForUUID?uuid=${t}`;return yield this.pollForCompletion(n,e,r)})}getUrlForSubMerchantAuthorization(t){return`${this.getMPSUrl(this.env)}/app/authorize/${t}`}pollForCompletion(t,e,r){return n(this,void 0,void 0,function*(){for(let n=0;n<e;n++){try{const r=yield this.droppHttpClient.getStatusForUUID(t);if(r&&0===r.responseCode&&"SUCCESS"===r.data)return r;if(n===e-1)return r}catch(t){(0,i.droppLog)(`Error in getStatusForUUID: ${t}`)}yield new Promise(t=>setTimeout(t,r))}throw new Error(`Polling failed after ${e} attempts.`)})}getMPSUrl(t){if("PROD"===t)return"https://merchant.portal.dropp.cc";if("QA"===t)return"https://merchantportal.qa.dropp.cc";if("SANDBOX"===t)return"https://sandbox.merchantportal.dropp.cc";throw"Unknown Environment for MPS URL"}}},702:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppRefundRequest=void 0;const o=r(328);e.DroppRefundRequest=class{constructor(t){this.droppClient=t}submit(t,e){return n(this,void 0,void 0,function*(){const r=Buffer.from(JSON.stringify(t)).toString("base64"),n={methodName:"refundMerchantPayment",refundBase64Bytes:r,signature:{merchant:o.DroppSignatureGenerator.generateMerchantSignature(Buffer.from(r).toString("hex"),e)}};return yield this.droppClient.postToDroppService("/payment/refund",n)})}}},724:(t,e,r)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.droppLog=function(t){console.log(`    - [${n.DROPP_SDK_NAME}] ${t}`)};const n=r(555)},857:t=>{t.exports=require("os")},866:function(t,e,r){var n=this&&this.__awaiter||function(t,e,r,n){return new(r||(r=Promise))(function(o,i){function s(t){try{p(n.next(t))}catch(t){i(t)}}function a(t){try{p(n.throw(t))}catch(t){i(t)}}function p(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r(function(t){t(e)})).then(s,a)}p((n=n.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.DroppRecurringPaymentRequest=void 0;const o=r(328),i=r(724);e.DroppRecurringPaymentRequest=class{constructor(t){this.droppClient=t}submitForAuthorization(t,e){return n(this,void 0,void 0,function*(){t.signatures.merchant=o.DroppSignatureGenerator.generateMerchantSignature(t.signatures.payer,e);const r="/api/rps/v1/payments";return(0,i.droppLog)(`url: ${r}`),(0,i.droppLog)(JSON.stringify(t)),t.dataInBase64=t.data,(0,i.droppLog)(`AFter: ${JSON.stringify(t)}`),yield this.droppClient.postToDroppService(r,t)})}submitForPayment(t,e){return n(this,void 0,void 0,function*(){const r=Buffer.from(JSON.stringify(t)).toString("base64"),n={signatures:{merchant:o.DroppSignatureGenerator.generateMerchantSignature(Buffer.from(JSON.stringify(t)).toString("hex"),e)},dataInBase64:r},i=(yield this.droppClient.postToDroppService("/api/rps/v1/payments/p2p",n)).data;return this.submit(i,e)})}submit(t,e){return n(this,void 0,void 0,function*(){return t.signatures.merchant=o.DroppSignatureGenerator.generateMerchantSignature(t.signatures.dropp,e),yield this.droppClient.postToDroppService("/api/rps/v1/payments/p2p/process",t)})}}},938:t=>{t.exports=require("axios")}},e={},r=function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n].call(i.exports,i,i.exports,r),i.exports}(440);for(var n in r)this[n]=r[n];r.__esModule&&Object.defineProperty(this,"__esModule",{value:!0})})();